#!/bin/sh

if [ ! "`type -t huntForSuifFile`X" == "functionX" ]; then
    echo "sourcing commonFunctions.sh again (lost?)"
    if [ ! -f "$WMUI_CACHE_HOME/01.scripts/commonFunctions.sh" ]; then
        echo "Panic, framework issue!"
        exit 500
    fi
    . "$WMUI_CACHE_HOME/01.scripts/commonFunctions.sh"
fi

thisFolder="02.templates/02.post-setup/Profiles/CVE-2021-44228-WA"

huntForSuifFile "${thisFolder}" "setEnvDefaults.sh"

if [ ! -f "${WMUI_CACHE_HOME}/${thisFolder}/setEnvDefaults.sh" ]; then
    logE "File not found: ${WMUI_CACHE_HOME}/${thisFolder}/setEnvDefaults.sh"
    exit 100
fi

. "${WMUI_CACHE_HOME}/${thisFolder}/setEnvDefaults.sh"

huntForSuifFile "${thisFolder}" "fix.sh"

logI "Applying CVE-2021-44228 security work around..."

. "${WMUI_CACHE_HOME}/${thisFolder}/fix.sh" "${WMUI_INSTALL_INSTALL_DIR}"